<!DOCTYPE html>
<html>

<head>
    <title>Photo Selection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        img {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
    <script>
        // Define your photo pools.
        // Update these paths if you have your own photos.
        const ambiguousPhotos = [
            "Stimulireal/concave.convex.jpg",
            "Stimulireal/donkey.seal.png",
            "Stimulireal/face.vase.png",
            "Stimulireal/frog.horse.jpg",
            "Stimulireal/jastrow.rabbit.jpg",
            "Stimulireal/Necker.cube.png",
            "Stimulireal/old.young.png",
            "Stimulireal/skeleton.ladies.jpg",
            "Stimulireal/Spinning_Dancer.gif",
            "Stimulireal/tunneldot.gif"
        ];
        const nonAmbiguousPhotos = [
            "Stimulireal/ur1.jpg",
            "Stimulireal/ur2.jpg",
            "Stimulireal/ur3.png",
            "Stimulireal/ur4.jpg",
            "Stimulireal/ur5.jpg",
            "Stimulireal/ur6.jpg",
            "Stimulireal/ur7.jpg",
            "Stimulireal/ur8.png",
            "Stimulireal/ur9.gif",
            "Stimulireal/ur10.gif"
        ];

        // Initialize the photo pools in localStorage if not already set.
        if (!localStorage.getItem("ambiguousPhotos")) {
            localStorage.setItem("ambiguousPhotos", JSON.stringify(ambiguousPhotos));
        }
        if (!localStorage.getItem("nonAmbiguousPhotos")) {
            localStorage.setItem("nonAmbiguousPhotos", JSON.stringify(nonAmbiguousPhotos));
        }

        // Ensure trialIndex exists (set by video_display.html).
        if (!localStorage.getItem("trialIndex")) {
            localStorage.setItem("trialIndex", "0");
        }
        let conditionList = JSON.parse(localStorage.getItem("conditionList") || "[]");
        // Function to select a photo based on the current trialâ€™s condition.
        function selectPhoto() {
            let trialIndex = parseInt(localStorage.getItem("trialIndex"), 10);
           

            // If no conditions exist, prompt the user to complete the video experiment first.
            if (conditionList.length === 0) {
                alert("No conditions available. Please complete the video experiment first.");
                window.location.href = "video_display.html";
                return;
            }
            // If all trials are completed, redirect to a thank-you page.
            if (trialIndex >= conditionList.length) {
                alert("All trials completed. Thank you!");
                window.location.href = "thank_you.html";
                return;
            }

            // Get the current condition (which specifies the photo type).
            let currentCondition = conditionList[trialIndex];
            // Choose the corresponding photo pool.
            let poolKey = (currentCondition.photoType === "ambiguous") ? "ambiguousPhotos" : "nonAmbiguousPhotos";
            let photoPool = JSON.parse(localStorage.getItem(poolKey) || "[]");

            console.log("Trial:", trialIndex + 1, "Using Pool:", poolKey, "Pool Length:", photoPool.length);

            if (photoPool.length === 0) {
                alert("No photos remain in the pool. Thank you!");
                window.location.href = "thank_you.html";
                return;
            }

            // Randomly select a photo and remove it from the pool.
            let randomIndex = Math.floor(Math.random() * photoPool.length);
            let selectedPhoto = photoPool.splice(randomIndex, 1)[0];
            localStorage.setItem(poolKey, JSON.stringify(photoPool));

            // Display the selected photo.
            const photoElement = document.getElementById("photo");
            photoElement.src = selectedPhoto;
            photoElement.alt = `Selected Photo: ${selectedPhoto}`;

            console.log("Selected Photo:", selectedPhoto, "Condition:", currentCondition);

            // Increment the trial index for the next trial.
            trialIndex++;
            localStorage.setItem("trialIndex", trialIndex.toString());
        }

        // Run the photo selection when the page loads.
        window.onload = selectPhoto;
    </script>
</head>

<body>
    <h1>Photo Selection</h1>
    <p>Here is your photo based on the experiment condition:</p>
    <img id="photo" src="" alt="Selected Photo">
    <br>
    <button onclick="window.location.href='video_display.html'">Next</button>
</body>

</html>
